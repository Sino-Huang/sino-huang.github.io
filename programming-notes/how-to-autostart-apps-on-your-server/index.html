<!DOCTYPE html>
<html dir="auto" lang="en">
<head><meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<meta content="index, follow" name="robots"/>
<title>How to Autostart Apps on Your Server | Sukai Huang</title>
<meta content="" name="keywords"/>
<meta content="[TOC]

Title: How to Autostart Apps on Your Server
Review Date: Fri, Apr 12, 2024
url: -

How to Autostart Apps on Your Server
we can try systemd --user  modules
First of all, write the service in the ~/.config/systemd/user/ folder


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


[Unit]
Description=My TorchSErve Server
Wants=network-online.target
After=network-online.target


[Service]
Type=forking
ExecStart=/datadrive/run_torchserve.sh

[Install]
WantedBy=multi-user.target


Note that Type=forking is important if you want to maintain the session, especially when you want to maintain a tmux" name="description"/>
<meta content="Sukai Huang" name="author"/>
<link href="https://sino-huang.github.io/programming-notes/how-to-autostart-apps-on-your-server/" rel="canonical"/>
<meta content="IFgzhtDTVCjONQMwQsBfuf0ZyHdzUR5WFYzbWsf2Gf8" name="google-site-verification"/>
<link as="style" crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet"/>
<link href="https://sino-huang.github.io/favicon.ico" rel="icon"/>
<link href="https://sino-huang.github.io/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="https://sino-huang.github.io/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="https://sino-huang.github.io/apple-touch-icon.png" rel="apple-touch-icon"/>
<link href="https://sino-huang.github.io/safari-pinned-tab.svg" rel="mask-icon"/>
<meta content="#2e2e33" name="theme-color"/>
<meta content="#2e2e33" name="msapplication-TileColor"/>
<link href="https://sino-huang.github.io/programming-notes/how-to-autostart-apps-on-your-server/" hreflang="en" rel="alternate"/>
<noscript>
<style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
<style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.min.css" integrity="sha384-veTAhWILPOotXm+kbR5uY7dRamYLJf58I7P+hJhjeuc7hsMAkJHTsPahAl0hBST0" rel="stylesheet"/>
<script crossorigin="anonymous" defer="" integrity="sha384-v6mkHYHfY/4BWq54f7lQAdtIsoZZIByznQ3ZqN38OL4KCsrxo31SLlPiak7cj/Mg" src="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.min.js"></script>
<script crossorigin="anonymous" defer="" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" src="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/contrib/auto-render.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-TTFTV1EWH5"></script>
<script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-TTFTV1EWH5');
        }
      </script><meta content="https://sino-huang.github.io/programming-notes/how-to-autostart-apps-on-your-server/" property="og:url"/>
<meta content="Sukai Huang" property="og:site_name"/>
<meta content="How to Autostart Apps on Your Server" property="og:title"/>
<meta content="[TOC]
Title: How to Autostart Apps on Your Server Review Date: Fri, Apr 12, 2024 url: - How to Autostart Apps on Your Server we can try systemd --user modules
First of all, write the service in the ~/.config/systemd/user/ folder
1 2 3 4 5 6 7 8 9 10 11 12 [Unit] Description=My TorchSErve Server Wants=network-online.target After=network-online.target [Service] Type=forking ExecStart=/datadrive/run_torchserve.sh [Install] WantedBy=multi-user.target Note that Type=forking is important if you want to maintain the session, especially when you want to maintain a tmux" property="og:description"/>
<meta content="en" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="programming-notes" property="article:section"/>
<meta content="2024-04-12T12:23:29+10:00" property="article:published_time"/>
<meta content="2024-04-12T12:23:29+10:00" property="article:modified_time"/>
<meta content="https://sino-huang.github.io/posts/how-to-autostart-apps-on-your-server/image-assets/cover.png" property="og:image"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="https://sino-huang.github.io/posts/how-to-autostart-apps-on-your-server/image-assets/cover.png" name="twitter:image"/>
<meta content="How to Autostart Apps on Your Server" name="twitter:title"/>
<meta content="[TOC]

Title: How to Autostart Apps on Your Server
Review Date: Fri, Apr 12, 2024
url: -

How to Autostart Apps on Your Server
we can try systemd --user  modules
First of all, write the service in the ~/.config/systemd/user/ folder


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


[Unit]
Description=My TorchSErve Server
Wants=network-online.target
After=network-online.target


[Service]
Type=forking
ExecStart=/datadrive/run_torchserve.sh

[Install]
WantedBy=multi-user.target


Note that Type=forking is important if you want to maintain the session, especially when you want to maintain a tmux" name="twitter:description"/>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Programming-Notes",
      "item": "https://sino-huang.github.io/programming-notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How to Autostart Apps on Your Server",
      "item": "https://sino-huang.github.io/programming-notes/how-to-autostart-apps-on-your-server/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Autostart Apps on Your Server",
  "name": "How to Autostart Apps on Your Server",
  "description": "[TOC]\nTitle: How to Autostart Apps on Your Server Review Date: Fri, Apr 12, 2024 url: - How to Autostart Apps on Your Server we can try systemd --user modules\nFirst of all, write the service in the ~/.config/systemd/user/ folder\n1 2 3 4 5 6 7 8 9 10 11 12 [Unit] Description=My TorchSErve Server Wants=network-online.target After=network-online.target [Service] Type=forking ExecStart=/datadrive/run_torchserve.sh [Install] WantedBy=multi-user.target Note that Type=forking is important if you want to maintain the session, especially when you want to maintain a tmux\n",
  "keywords": [
    
  ],
  "articleBody": "[TOC]\nTitle: How to Autostart Apps on Your Server Review Date: Fri, Apr 12, 2024 url: - How to Autostart Apps on Your Server we can try systemd --user modules\nFirst of all, write the service in the ~/.config/systemd/user/ folder\n1 2 3 4 5 6 7 8 9 10 11 12 [Unit] Description=My TorchSErve Server Wants=network-online.target After=network-online.target [Service] Type=forking ExecStart=/datadrive/run_torchserve.sh [Install] WantedBy=multi-user.target Note that Type=forking is important if you want to maintain the session, especially when you want to maintain a tmux\nUnderstanding Type=forking in systemd In systemd, the Type= option in the service unit file specifies the service’s process start-up behavior, influencing how systemd manages and tracks the service’s main process. For services that start by forking off a child process (which continues running after the parent exits), Type=forking is the appropriate choice. This is a common pattern for traditional daemons that double-fork to detach themselves from the controlling terminal and run in the background.\nWhen Type=forking is set, systemd expects the service to:\nStart a parent process. Fork a child process from the parent. Have the parent process exit. Continue running in the background with the child process. Systemd then tracks the child process as the main service process. This is useful for services that need to perform some initial setup in the parent process before running the service logic in the background.\nWhy Type=forking Works with tmux tmux commands like tmux new-session -d start a new session in detached mode and then immediately exit. This behavior is somewhat similar to forking, in that the command that starts the session exits quickly, but the session itself (and any processes running within it) continues in the background, independent of the shell it was started from.\nHere’s why setting Type=forking helps in your systemd unit file for tmux:\nInitial Process Exit: The tmux command used in ExecStart exits after creating the detached session. With Type=simple (the default if Type= is not specified), systemd expects the service’s main process to stay active. When the tmux command exits, systemd thinks the service has stopped. Background Continuation: By using Type=forking, you signal to systemd that the exiting of the initial process (the tmux command) is expected behavior and that it should consider the background continuation of the session as the service running successfully. Systemd then treats the service as active even after the tmux command itself has exited, as long as there’s a background process associated with it. Important Considerations While Type=forking helps keep the tmux session active under systemd control, it’s important to note a few considerations:\nProcess Tracking: Systemd might have difficulty tracking the exact process of the tmux session as the service’s main process since tmux doesn’t behave like a traditional daemon (it doesn’t provide a PID file for the child process). Systemd relies on the PID of the last background process, but in the case of tmux, this is managed internally by tmux. Service Management: Actions like stopping or restarting the service rely on correctly identifying the process to manage. Ensure your ExecStop command correctly terminates the tmux session. Using Type=forking in this way is a bit unconventional but can be effective for specific use cases like yours. It’s a clever solution to integrate tmux session management within the systemd framework, especially when you need to ensure a tmux session starts automatically and persists in the background.\nReload systemd daemon 1 2 3 4 5 6 # reload daemon systemctl --user daemon-reload # enable service systemctl --user enable mytorchserve.service # enable no logging start sudo loginctl enable-linger $USER Check the log 1 journalctl --user-unit=mytorchserve.service -f -e Manually start the service systemctl --user restart mytorchserve.service\nUser systemctl and User runtime directory ref: https://superuser.com/questions/1561076/systemctl-user-failed-to-connect-to-bus-no-such-file-or-directory-debian-9\nSolution: Using sudo loginctl enable-linger $USER makes systemd keep the user’s systemd --user process running even after the user logs out. This is crucial for running background services under that user without requiring them to be continuously logged in.\nmonitor by loginctl list-users\nIssue: If XDG_RUNTIME_DIR isn’t set in crontab or other auto task-scheduling scripts, then tools like systemctl --user might fail because they cannot find the correct runtime directory to communicate with systemd --user.\nSolution: export XDG_RUNTIME_DIR=/run/user/$(id -u);\nAdd-on: Cron service 1 2 3 4 # For more information see the manual pages of crontab(5) and cron(8) # # m h dom mon dow command */5 * * * * export XDG_RUNTIME_DIR=/run/user/$(id -u); /datadrive/check_service.sh \u003e\u003e /datadrive/check_service_cron.log 2\u003e\u00261 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash # Perform the curl request and capture the response response=$(curl http://10.102.5.4:8080/ping 2\u003e\u00261) # echo \"Response ${response}\" # Check if the response contains \"Healthy\" if [[ \"$response\" == *'\"status\": \"Healthy\"'* ]]; then echo \"All good at $(date)\" else # Check for 'Connection refused' in the response if [[ \"$response\" == *\"Connection refused\"* ]]; then echo \"Restart Service at $(date)\" systemctl --user restart mytorchserve.service fi fi Tmux activate server example 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/bash sessname=\"server\" echo $USER is running the script /usr/bin/tmux new-session -d -s \"$sessname\" if [[ $? -eq 1 ]]; then /usr/bin/tmux kill-session -t \"$sessname\" /usr/bin/tmux new-session -d -s \"$sessname\" fi sleep 5 echo `/usr/bin/tmux ls` tmux send-keys -t \"$sessname\" \"cd /datadrive ; sudo systemctl stop docker.service ; cp docker.service.config.bak /lib/systemd/system/docker.service\" Enter tmux send-keys -t \"$sessname\" \"sudo systemctl daemon-reload ; sudo systemctl start docker.service\" Enter tmux send-keys -t \"$sessname\" \"cd /datadrive/avmmodel_project/torchserve-deployment ; sudo docker stop torchserve-dev-apr-12-2 ; sudo docker container rm torchserve-dev-apr-12-2\" Enter sleep 2 tmux send-keys -t \"$sessname\" 'sudo docker rmi -f $(sudo docker images -f \"dangling=true\" -q)' Enter sleep 2 tmux send-keys -t \"$sessname\" 'sudo docker build -t avmmodel_image . -f torchserve.dockerfile' Enter sleep 2 tmux send-keys -t \"$sessname\" 'sudo docker run -p 8080:8089 --name torchserve-dev-apr-12-2 -v ./torchserve:/torchserve avmmodel_image' Enter tmux split-window -v -t \"$sessname\" tmux send-keys -t \"$sessname:0.1\" 'htop' Enter tmux split-window -h -t \"$sessname\" tmux send-keys -t \"$sessname:0.2\" 'sudo watch -n 1 df -h' Enter tmux split-window -h -t \"$sessname\" tmux send-keys -t \"$sessname:0.3\" 'cd /datadrive' Enter Relocate the docker lib Edit docker service configuration with: sudo vi /lib/systemd/system/docker.service Locate the Exec line: ExecStart=/usr/bin/dockerd -H fd:// –containerd=/run/containerd/containerd.sock Add a parameter that points docker to the new directory: ExecStart=/usr/bin/dockerd –data-root /second_drive/docker -H fd:// –containerd=/run/containerd/containerd.sock 1 2 3 4 5 6 sudo systemctl stop docker.service # edit your docker.service.config.bak sudo chown root:root docker.service.config.bak # make sure the owner for docker config file is root cp docker.service.config.bak /lib/systemd/system/docker.service sudo systemctl daemon-reload sudo systemctl start docker ",
  "wordCount" : "1109",
  "inLanguage": "en",
  "image":"https://sino-huang.github.io/posts/how-to-autostart-apps-on-your-server/image-assets/cover.png","datePublished": "2024-04-12T12:23:29+10:00",
  "dateModified": "2024-04-12T12:23:29+10:00",
  "author":{
    "@type": "Person",
    "name": "Sukai Huang"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sino-huang.github.io/programming-notes/how-to-autostart-apps-on-your-server/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sukai Huang",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sino-huang.github.io/favicon.ico"
    }
  }
}
</script>
</head>
<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<header class="header">
<nav class="nav">
<div class="logo">
<a accesskey="h" href="https://sino-huang.github.io/" title="Sukai Huang (Alt + H)">Sukai Huang</a>
<div class="logo-switches">
<button accesskey="t" id="theme-toggle" title="(Alt + T)">
<svg fill="none" height="18" id="moon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>
<svg fill="none" height="18" id="sun" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
</button>
</div>
</div>
<ul id="menu">
<li>
<a href="https://sino-huang.github.io/biography/" title="Biography">
<span>Biography</span>
</a>
</li>
<li>
<a href="https://sino-huang.github.io/archives" title="Archive">
<span>Archive</span>
</a>
</li>
<li>
<a href="https://sino-huang.github.io/tags/" title="Tags">
<span>Tags</span>
</a>
</li>
<li>
<a href="https://sino-huang.github.io/categories/" title="Categories">
<span>Categories</span>
</a>
</li>
<li>
<a accesskey="/" href="https://sino-huang.github.io/search/" title="Search (Alt + /)">
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class="main">
<article class="post-single">
<header class="post-header">
<div class="breadcrumbs"><a href="https://sino-huang.github.io/">Home</a> » <a href="https://sino-huang.github.io/programming-notes/">Programming-Notes</a></div>
<h1 class="post-title entry-hint-parent">
      How to Autostart Apps on Your Server
    </h1>
<div class="post-meta"><span title="2024-04-12 12:23:29 +1000 AEST">April 12, 2024</span> · 6 min · 1109 words · Sukai Huang | <a href="mailto:sukaih@student.unimelb.edu.au/programming-notes/how-to-autostart-apps-on-your-server/index.md" rel="noopener noreferrer" target="_blank">Submit a report</a>
</div>
</header>
<figure class="entry-cover"><img alt="" loading="eager" src="https://sino-huang.github.io/posts/how-to-autostart-apps-on-your-server/image-assets/cover.png"/>
<p><text></text></p>
</figure><div class="toc">
<details>
<summary accesskey="c" title="(Alt + C)">
<span class="details">Table of Contents</span>
</summary>
<div class="inner"><ul>
<li>
<a aria-label="How to Autostart Apps on Your Server" href="#how-to-autostart-apps-on-your-server">How to Autostart Apps on Your Server</a><ul>
<li>
<a aria-label="Understanding Type=forking in systemd" href="#understanding-typeforking-in-systemd">Understanding Type=forking in systemd</a></li>
<li>
<a aria-label="Why Type=forking Works with tmux" href="#why-typeforking-works-with-tmux">Why Type=forking Works with tmux</a></li>
<li>
<a aria-label="Important Considerations" href="#important-considerations">Important Considerations</a></li>
<li>
<a aria-label="Reload systemd daemon" href="#reload-systemd-daemon">Reload systemd daemon</a></li></ul>
</li>
<li>
<a aria-label="Check the log" href="#check-the-log">Check the log</a></li>
<li>
<a aria-label="Manually start the service" href="#manually-start-the-service">Manually start the service</a><ul>
<li>
<a aria-label="User systemctl and User runtime directory" href="#user-systemctl-and-user-runtime-directory">User systemctl and User runtime directory</a></li></ul>
</li>
<li>
<a aria-label="Add-on: Cron service" href="#add-on-cron-service">Add-on: Cron service</a></li>
<li>
<a aria-label="Tmux activate server example" href="#tmux-activate-server-example">Tmux activate server example</a></li>
<li>
<a aria-label="Relocate the docker lib" href="#relocate-the-docker-lib">Relocate the docker lib</a>
</li>
</ul>
</div>
</details>
</div>
<div class="post-content"><p>[TOC]</p>
<ol>
<li>Title: How to Autostart Apps on Your Server</li>
<li>Review Date: Fri, Apr 12, 2024</li>
<li>url: -</li>
</ol>
<h2 id="how-to-autostart-apps-on-your-server">How to Autostart Apps on Your Server<a aria-hidden="true" class="anchor" hidden="" href="#how-to-autostart-apps-on-your-server">#</a></h2>
<p>we can try <code>systemd --user </code> modules</p>
<p>First of all, write the service in the <code>~/.config/systemd/user/</code> folder</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>Unit<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Description</span><span class="o">=</span>My TorchSErve Server
</span></span><span class="line"><span class="cl"><span class="nv">Wants</span><span class="o">=</span>network-online.target
</span></span><span class="line"><span class="cl"><span class="nv">After</span><span class="o">=</span>network-online.target
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Service<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Type</span><span class="o">=</span>forking
</span></span><span class="line"><span class="cl"><span class="nv">ExecStart</span><span class="o">=</span>/datadrive/run_torchserve.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Install<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that <code>Type=forking</code> is important if you want to maintain the session, especially when you want to maintain a tmux</p>
<h3 id="understanding-typeforking-in-systemd">Understanding <code>Type=forking</code> in systemd<a aria-hidden="true" class="anchor" hidden="" href="#understanding-typeforking-in-systemd">#</a></h3>
<p>In systemd, the <code>Type=</code> option in the service unit file specifies the service’s process start-up behavior, influencing how systemd manages and tracks the service’s main process. For services that start by forking off a child process (which continues running after the parent exits), <code>Type=forking</code> is the appropriate choice. This is a common pattern for traditional daemons that double-fork to detach themselves from the controlling terminal and run in the background.</p>
<p>When <code>Type=forking</code> is set, systemd expects the service to:</p>
<ul>
<li>Start a parent process.</li>
<li>Fork a child process from the parent.</li>
<li>Have the parent process exit.</li>
<li>Continue running in the background with the child process.</li>
</ul>
<p>Systemd then tracks the child process as the main service process. This is useful for services that need to perform some initial setup in the parent process before running the service logic in the background.</p>
<h3 id="why-typeforking-works-with-tmux">Why <code>Type=forking</code> Works with <code>tmux</code><a aria-hidden="true" class="anchor" hidden="" href="#why-typeforking-works-with-tmux">#</a></h3>
<p><code>tmux</code> commands like <code>tmux new-session -d</code> start a new session in detached mode and then immediately exit. This behavior is somewhat similar to forking, in that the command that starts the session exits quickly, but the session itself (and any processes running within it) continues in the background, independent of the shell it was started from.</p>
<p>Here’s why setting <code>Type=forking</code> helps in your systemd unit file for <code>tmux</code>:</p>
<ul>
<li><strong>Initial Process Exit</strong>: The <code>tmux</code> command used in <code>ExecStart</code> exits after creating the detached session. With <code>Type=simple</code> (the default if <code>Type=</code> is not specified), systemd expects the service’s main process to stay active. When the <code>tmux</code> command exits, systemd thinks the service has stopped.</li>
<li><strong>Background Continuation</strong>: By using <code>Type=forking</code>, you signal to systemd that the exiting of the initial process (the <code>tmux</code> command) is expected behavior and that it should consider the background continuation of the session as the service running successfully. Systemd then treats the service as active even after the <code>tmux</code> command itself has exited, as long as there’s a background process associated with it.</li>
</ul>
<h3 id="important-considerations">Important Considerations<a aria-hidden="true" class="anchor" hidden="" href="#important-considerations">#</a></h3>
<p>While <code>Type=forking</code> helps keep the <code>tmux</code> session active under systemd control, it’s important to note a few considerations:</p>
<ul>
<li><strong>Process Tracking</strong>: Systemd might have difficulty tracking the exact process of the <code>tmux</code> session as the service’s main process since <code>tmux</code> doesn’t behave like a traditional daemon (it doesn’t provide a PID file for the child process). Systemd relies on the PID of the last background process, but in the case of <code>tmux</code>, this is managed internally by <code>tmux</code>.</li>
<li><strong>Service Management</strong>: Actions like stopping or restarting the service rely on correctly identifying the process to manage. Ensure your <code>ExecStop</code> command correctly terminates the <code>tmux</code> session.</li>
</ul>
<p>Using <code>Type=forking</code> in this way is a bit unconventional but can be effective for specific use cases like yours. It’s a clever solution to integrate <code>tmux</code> session management within the systemd framework, especially when you need to ensure a <code>tmux</code> session starts automatically and persists in the background.</p>
<h3 id="reload-systemd-daemon">Reload systemd daemon<a aria-hidden="true" class="anchor" hidden="" href="#reload-systemd-daemon">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># reload daemon</span>
</span></span><span class="line"><span class="cl">systemctl --user daemon-reload
</span></span><span class="line"><span class="cl"><span class="c1"># enable service</span>
</span></span><span class="line"><span class="cl">systemctl --user <span class="nb">enable</span> mytorchserve.service
</span></span><span class="line"><span class="cl"><span class="c1"># enable no logging start</span>
</span></span><span class="line"><span class="cl">sudo loginctl enable-linger <span class="nv">$USER</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="check-the-log">Check the log<a aria-hidden="true" class="anchor" hidden="" href="#check-the-log">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">journalctl --user-unit<span class="o">=</span>mytorchserve.service -f -e
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="manually-start-the-service">Manually start the service<a aria-hidden="true" class="anchor" hidden="" href="#manually-start-the-service">#</a></h2>
<p><code>systemctl --user restart mytorchserve.service</code></p>
<h3 id="user-systemctl-and-user-runtime-directory">User systemctl and User runtime directory<a aria-hidden="true" class="anchor" hidden="" href="#user-systemctl-and-user-runtime-directory">#</a></h3>
<p>ref: <a href="https://superuser.com/questions/1561076/systemctl-user-failed-to-connect-to-bus-no-such-file-or-directory-debian-9">https://superuser.com/questions/1561076/systemctl-user-failed-to-connect-to-bus-no-such-file-or-directory-debian-9</a></p>
<p><strong>Solution</strong>: Using <code>sudo loginctl enable-linger $USER</code> makes <code>systemd</code> keep the user’s <code>systemd --user</code> process running even after the user logs out. This is crucial for  running background services under that user without requiring them to be continuously logged in.</p>
<p>monitor by <code>loginctl list-users</code></p>
<p><strong>Issue</strong>: If <code>XDG_RUNTIME_DIR</code> isn’t set in <code>crontab</code> or other auto task-scheduling scripts, then tools like <code>systemctl --user</code> might fail because they cannot find the correct runtime directory to communicate with <code>systemd --user</code>.</p>
<p><strong>Solution</strong>: <code>export XDG_RUNTIME_DIR=/run/user/$(id -u);</code></p>
<h2 id="add-on-cron-service">Add-on: Cron service<a aria-hidden="true" class="anchor" hidden="" href="#add-on-cron-service">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># For more information see the manual pages of crontab(5) and cron(8)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># </span>
</span></span><span class="line"><span class="cl"><span class="c1"># m h  dom mon dow   command</span>
</span></span><span class="line"><span class="cl">*/5 * * * * <span class="nb">export</span> <span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span>/run/user/<span class="k">$(</span>id -u<span class="k">)</span><span class="p">;</span> /datadrive/check_service.sh &gt;&gt; /datadrive/check_service_cron.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># Perform the curl request and capture the response</span>
</span></span><span class="line"><span class="cl"><span class="nv">response</span><span class="o">=</span><span class="k">$(</span>curl http://10.102.5.4:8080/ping 2&gt;<span class="p">&amp;</span>1<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># echo "Response ${response}"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check if the response contains "Healthy"</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$response</span><span class="s2">"</span> <span class="o">==</span> *<span class="s1">'"status": "Healthy"'</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">"All good at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Check for 'Connection refused' in the response</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$response</span><span class="s2">"</span> <span class="o">==</span> *<span class="s2">"Connection refused"</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">"Restart Service at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">    systemctl --user restart mytorchserve.service
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="tmux-activate-server-example">Tmux activate server example<a aria-hidden="true" class="anchor" hidden="" href="#tmux-activate-server-example">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">sessname</span><span class="o">=</span><span class="s2">"server"</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$USER</span> is running the script
</span></span><span class="line"><span class="cl">/usr/bin/tmux new-session -d -s <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -eq <span class="m">1</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    /usr/bin/tmux kill-session -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">    /usr/bin/tmux new-session -d -s <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sleep <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="sb">`</span>/usr/bin/tmux ls<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s2">"cd /datadrive ; sudo systemctl stop docker.service ; cp docker.service.config.bak /lib/systemd/system/docker.service"</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s2">"sudo systemctl daemon-reload ; sudo systemctl start docker.service"</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s2">"cd /datadrive/avmmodel_project/torchserve-deployment ; sudo docker stop torchserve-dev-apr-12-2 ; sudo docker container rm torchserve-dev-apr-12-2"</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sleep <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s1">'sudo docker rmi -f  $(sudo docker images -f "dangling=true" -q)'</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sleep <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s1">'sudo docker build -t avmmodel_image . -f torchserve.dockerfile'</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sleep <span class="m">2</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span> <span class="s1">'sudo docker run -p 8080:8089 --name torchserve-dev-apr-12-2 -v ./torchserve:/torchserve avmmodel_image'</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux split-window -v -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">:0.1"</span> <span class="s1">'htop'</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux split-window -h -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">:0.2"</span> <span class="s1">'sudo watch -n 1 df -h'</span> Enter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux split-window -h -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tmux send-keys -t <span class="s2">"</span><span class="nv">$sessname</span><span class="s2">:0.3"</span> <span class="s1">'cd /datadrive'</span> Enter
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="relocate-the-docker-lib">Relocate the docker lib<a aria-hidden="true" class="anchor" hidden="" href="#relocate-the-docker-lib">#</a></h2>
<ol>
<li>Edit docker service configuration with:
sudo vi /lib/systemd/system/docker.service</li>
<li>Locate the Exec line:
ExecStart=/usr/bin/dockerd -H fd:// –containerd=/run/containerd/containerd.sock</li>
<li>Add a parameter that points docker to the new directory:
ExecStart=/usr/bin/dockerd <strong>–data-root /second_drive/docker</strong> -H fd:// –containerd=/run/containerd/containerd.sock</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl stop docker.service
</span></span><span class="line"><span class="cl"><span class="c1"># edit your docker.service.config.bak</span>
</span></span><span class="line"><span class="cl">sudo chown root:root docker.service.config.bak <span class="c1"># make sure the owner for docker config file is root</span>
</span></span><span class="line"><span class="cl">cp docker.service.config.bak /lib/systemd/system/docker.service
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl start docker
</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<footer class="post-footer">
<ul class="post-tags">
</ul>
<nav class="paginav">
<a class="prev" href="https://sino-huang.github.io/posts/shanchuan-efficient-n-robust-exploration-through-discriminative-ir-2023/">
<span class="title">« Prev</span>
<br/>
<span>Shanchuan Efficient N Robust Exploration Through Discriminative Ir 2023</span>
</a>
<a class="next" href="https://sino-huang.github.io/posts/seungyong-discover-hierarchical-achieve-in-rl-via-cl-2023/">
<span class="title">Next »</span>
<br/>
<span>Discover Hierarchical Achieve in Rl via Cl 2023</span>
</a>
</nav>
<ul class="share-buttons">
<li>
<a aria-label="share How to Autostart Apps on Your Server on x" href="https://x.com/intent/tweet/?text=How%20to%20Autostart%20Apps%20on%20Your%20Server&amp;url=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f&amp;hashtags=" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve">
<path d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f&amp;title=How%20to%20Autostart%20Apps%20on%20Your%20Server&amp;summary=How%20to%20Autostart%20Apps%20on%20Your%20Server&amp;source=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve">
<path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f&amp;title=How%20to%20Autostart%20Apps%20on%20Your%20Server" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve">
<path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve">
<path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20Autostart%20Apps%20on%20Your%20Server%20-%20https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve">
<path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on telegram" href="https://telegram.me/share/url?text=How%20to%20Autostart%20Apps%20on%20Your%20Server&amp;url=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="2 2 28 28" width="30px" xml:space="preserve">
<path d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z"></path>
</svg>
</a>
</li>
<li>
<a aria-label="share How to Autostart Apps on Your Server on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20Autostart%20Apps%20on%20Your%20Server&amp;u=https%3a%2f%2fsino-huang.github.io%2fprogramming-notes%2fhow-to-autostart-apps-on-your-server%2f" rel="noopener noreferrer" target="_blank">
<svg fill="currentColor" height="30px" version="1.1" viewbox="0 0 512 512" width="30px" xml:space="preserve" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
<path d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z"></path>
</svg>
</a>
</li>
</ul>
</footer>
</article>
</main>
<footer class="footer">
<span>© 2025 <a href="https://sino-huang.github.io/">Sukai Huang</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &amp;
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
</span>
</footer>
<a accesskey="g" aria-label="go to top" class="top-link" href="#top" id="top-link" title="Go to Top (Alt + G)">
<svg fill="currentColor" viewbox="0 0 12 6" xmlns="http://www.w3.org/2000/svg">
<path d="M12 6H0l6-6z"></path>
</svg>
</a>
<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>
</html>
